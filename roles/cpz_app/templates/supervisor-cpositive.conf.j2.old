[program:cpz_worker]
command=
   {{ project_pve }}/bin/celery
   -A cpz worker
   -l info
   --concurrency={{ main_worker_concurrency }}
   -n %(program_name)s.%%n

environment=
  HOME="{{ web_app_user_home }}",
  DJANGO_SETTINGS_MODULE="{{ django_settings_module }}"

user={{ web_app_user }}
directory={{ backend_project_dir }}
autostart=false
autorestart=true

redirect_stderr=true
stderr_logfile={{ logs_home }}/%(program_name)s_err.log
redirect_stdout=true
stdout_logfile={{ logs_home }}/%(program_name)s.log


[program:cpz_beat]
command={{ project_pve }}/bin/celery -A cpz beat -l info

environment=
  HOME="{{ web_app_user_home }}",
  DJANGO_SETTINGS_MODULE="{{ django_settings_module }}"

user={{ web_app_user }}
directory={{ backend_project_dir }}
autostart=false
autorestart=true

redirect_stderr=true
stderr_logfile={{ logs_home }}/%(program_name)s_err.log
redirect_stdout=true
stdout_logfile={{ logs_home }}/%(program_name)s.log


# [program:cpz_uwsgi]
# command={{ project_pve }}/bin/uwsgi --yaml {{ backend_project_dir }}/cpz.yaml

[program:cpz_gunicorn]
command={{ project_pve }}/bin/gunicorn cpz.wsgi:application
  -b unix://{{ /tmp/cpz_backend.sock }}

#--yaml {{ backend_project_dir }}/uwsgi.yaml

environment=
  DJANGO_SETTINGS_MODULE="{{ django_settings_module }}",
  SECRET_KEY="123"

user={{ web_app_user }}
directory={{ backend_project_dir }}
autostart=true
autorestart=true


[group:cpz]
# programs = cpz_worker,cpz_beat,cpz_uwsgi
programs = cpz_gunicorn
startretries = 2
user = {{ web_app_user }}
